$(function(){var t,i,c,s="Заказать",r="Назад",m=$(".products-cart"),o=$(".cart-notify"),f=$(".header__cart-count");function e(t,e){e=e||1;var i=$(t+" .header__top");$(document).scroll(function(){i.toggleClass("scrolled",$(this).scrollTop()>=window.innerHeight*e-i.outerHeight()/2)}),i.toggleClass("scrolled",$(document).scrollTop()>=window.innerHeight*e-i.outerHeight()/2)}function h(t){f.html(t)}function a(){var t=JSON.parse(localStorage.getItem("cart")||"{}");return t.products=t.products||{},t}function v(t){localStorage.setItem("cart",JSON.stringify(t))}function g(){m.find(".products-cart__order").html(s),m.toggleClass("opened"),m.hasClass("full-opened")&&m.toggleClass("full-opened")}$(".header__menu-btn").click(function(){$(".header__menu-list").toggleClass("header__menu-list_visible")}),$.fn.inputFilter=function(t){return this.on("input keydown keyup mousedown mouseup select contextmenu drop",function(){t(this.value)?(this.oldValue=this.value,this.oldSelectionStart=this.selectionStart,this.oldSelectionEnd=this.selectionEnd):this.hasOwnProperty("oldValue")?(this.value=this.oldValue,this.setSelectionRange(this.oldSelectionStart,this.oldSelectionEnd)):this.value=""})},(t=a()).date&&864e5<(new Date).getTime()-t.date&&localStorage.removeItem("cart"),i=0,c=a().products,Object.keys(c).forEach(function(t){var e=c[t];i+=parseInt(e.count)}),h(i),$("#order-date").flatpickr({defaultDate:new Date,minDate:new Date}),$("#order-time").flatpickr({noCalendar:!0,time_24hr:!0,enableTime:!0,minDate:new Date((new Date).getTime()+54e5),defaultDate:new Date((new Date).getTime()+54e5),dateFormat:"H:i"}),$(".products-cart__form").click(function(t){t.stopPropagation()}),$(".header__cart").click(function(t){m.toggleClass("opened"),t.preventDefault();var d=a(),p=0,_=m.find(".products-cart__list");_.empty(),Object.keys(d.products).forEach(function(t){var e,i,c,s,r,a,n,o,l=d.products[t],u=(e=l.thumb,i=t,c=parseInt(l.price),s=l.count,r=l.price*l.count,"<div class='products-cart__item'><span class='products-cart__item-close'>X</span><div class='cart__item-thumb 'style='background-image: "+e+"'></div><div class='cart__item-title'>"+i+"</div><div class='cart__item-price'><span class='products__item-currency'>₴</span>"+c+"</div><div class='count cart__item-count products__item-count'><a class='button products__item-minus' href='#'>-</a><input type='text' class='products__item-number' size='3' maxlength='3' value='"+s+"' readonly=''><a class='button products__item-plus' href='#'>+</a></div><div class='cart__item-total'><span class='products__item-currency'>₴</span><span class='cart__item-total-number'>"+r+"</span></span></div></div>");_.prepend(u),p+=l.price*l.count,a=_.children().first(),n=t,o=d,a.click(function(t){t.preventDefault();var e=t.target.getAttribute("class"),i=$(this).find(".products__item-number"),c=$(this).find(".cart__item-total-number"),s=m.find(".products-cart__total-value"),r=parseInt(s.html());if(e.includes("products-cart__item-close"))t.currentTarget.remove(),h(parseInt(f.html())-o.products[n].count),r-=parseInt(o.products[n].price)*parseInt(o.products[n].count),delete o.products[n],0==Object.keys(o.products).length&&(v({}),g(),h(0));else if(e.includes("button products__item-minus")){if(1==(a=parseInt(i.val())))return;h(parseInt(f.html())-1),i.val(a-1),o.products[n].count--,r-=parseInt(o.products[n].price),c.html(o.products[n].count*o.products[n].price)}else if(e.includes("button products__item-plus")){var a=parseInt(i.val());h(parseInt(f.html())+1),i.val(a+1),o.products[n].count++,r+=parseInt(o.products[n].price),c.html(o.products[n].count*o.products[n].price)}v(o),s.html(r)})}),m.find(".products-cart__total-value").html(p)}),m.click(function(){g()}),$(".products-cart__form").click(function(t){t.stopPropagation();var e=t.target,i=this.querySelector(".products-cart__order");if(e.classList.contains("products-cart__close"))g();else if(e.classList.contains("products-cart__order")||e.classList.contains("order-subform__close")){if(t.preventDefault(),!m.find(".products-cart__list").children().length)return;i.textContent=i.textContent==r?s:r,m.toggleClass("full-opened")}}),$(".products-cart__form").on("submit",function(){m.toggleClass("full-opened"),v({}),g(),h(0),$(this).trigger("reset")}),$(document).on("click",'a[href*="#"]',function(t){var e=$(".header__top"),i=$.attr(this,"href");if(1!=i.length){var c=$("#"+i.split("#")[1]);$("html, body").animate({scrollTop:c.offset().top-e.outerHeight()},500)}}),$(".header__slider").slick({autoplay:!0,autoplaySpeed:3e3,speed:1200}),e(".home-content");var n=$(".products");if(n){var l=n.find(".products-tab");function u(t){var e=a(),i=e.products[t.title];i?i.count=Number(i.count)+Number(t.count):i={count:t.count},i.price=t.price,i.thumb=t.thumb,e.products[t.title]=i,e.date=(new Date).getTime(),v(e),h(parseInt(t.count)+parseInt(f.html()))}l.click(function(t){if(!$(this).hasClass("active")){var e=$(this).attr("data-id");n.find(".products-tab__content").hide(),l.removeClass("active"),$(this).addClass("active"),$("#category-"+e).show()}}),n.find(".subcategory-title").click(function(t){$(this).toggleClass("shrink")}),n.find(".products__item").click(function(t){t.preventDefault();var e,i,c=t.target.getAttribute("class"),s=$(this).find(".products__item-number"),r=s.val();if(c.includes("products__item-info"))$.magnificPopup.instance.open(Object.assign({},d,{index:$(this).index(".products__item")}));else if(c.includes("products__item-minus")){if(1==r)return;s.val(--r)}else if(c.includes("products__item-plus"))s.val(++r);else if(c.includes("products__item-buy")){var a=$(this).find(".products__item-img").css("background-image"),n=$(this).find(".products__item-title").html();u({title:n,thumb:a,price:$(this).find(".products__item-price-value").html(),count:r}),e=n,i=a,"none"==o.css("display")&&(o.find(".cart__item-title").html(e),o.find(".cart-notify__thumb").css("background-image",i),o.fadeIn(500).delay(1500).fadeOut(500))}});var d={key:"products-popup",items:Array.from(n.find(".products__item")).map(function(t){return{image:t.querySelector(".products__item-img").style.backgroundImage,title:t.querySelector(".products__item-title").innerHTML,price:t.querySelector(".products__item-price-value").innerHTML,description:t.querySelector(".products__item-descr").innerHTML.trim(),count:t.querySelector(".products__item-number").value}}),type:"inline",inline:{markup:'<section class="product-details product-details__popup"><div class="mfp-close product-datails__close-btn"></div><div class="product-details__inner"><div class="product-details__img" style="background-image: url();"></div><div class="product-details__content"><div class="product-details__title"></div><div class="product-details__subtitle"><span class="product-details__price"><span class="products__item-currency">&#8372;</span><span class="product-details__price-value"></span></span><span class="product-details__rate"></span></div><p class="product-details__descr"></p><div class="product-details__controls"><input class="product-details__count" maxlength="3" type="text" value=""/><a class="product-details-buy products__item-buy" href="#">В корзину</a></div></div></div></section>'},gallery:{enabled:!0},callbacks:{open:function(){var r=$.magnificPopup.instance;r.content.find(".product-details-buy").click(function(t){var e=r.currItem.data.title,i=r.currItem.data.price,c=r.currItem.data.image,s=r.content.find(".product-details__count").val();t.preventDefault(),r.close(),u({title:e,thumb:c,price:i,count:s})})},markupParse:function(t,e,i){t.find(".product-details__rate").rateYo({rating:4,starWidth:"24px"}),t.find(".product-details__count").inputFilter(function(t){return/^\d*$/.test(t)&&0<t}),t.find(".product-details__img").css("background-image",e.image),t.find(".product-details__title").html(e.title),t.find(".product-details__price-value").html(e.price),t.find(".product-details__descr").html(e.description),t.find(".product-details__count").val(e.count)}}}}e(".delivery-content",.6),e(".contacts-content",.65)});